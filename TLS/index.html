



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>TLS - Hybrid Integration Reference Architecture</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#configure-tls-end-to-end-between-ibm-cloud-app-and-back-end-service" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Hybrid Integration Reference Architecture" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Hybrid Integration Reference Architecture
            </span>
            <span class="md-header-nav__topic">
              TLS
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ibm-cloud-architecture/refarch-integration/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Hybrid Integration Reference Architecture" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Hybrid Integration Reference Architecture
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ibm-cloud-architecture/refarch-integration/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Hybrid Cloud Integration introduction" class="md-nav__link">
      Hybrid Cloud Integration introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../hybrid-ref-arch/" title="Hybrid Cloud Integration reference architecture" class="md-nav__link">
      Hybrid Cloud Integration reference architecture
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../buildrun/" title="DevOps Build, deploy and run" class="md-nav__link">
      DevOps Build, deploy and run
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Doing MQ, DB2 and JEE on WAS lift and shift to IBM Cloud
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Doing MQ, DB2 and JEE on WAS lift and shift to IBM Cloud
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../toSaaS/readme/" title="Context" class="md-nav__link">
      Context
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../toSaaS/twas/readme/" title="Tarditional WAS app" class="md-nav__link">
      Tarditional WAS app
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../nfr/" title="Non-functional requirements" class="md-nav__link">
      Non-functional requirements
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../devops/" title="Apply CI/CD for integration solution" class="md-nav__link">
      Apply CI/CD for integration solution
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../compendium/" title="Hybrid Cloud Compendium" class="md-nav__link">
      Hybrid Cloud Compendium
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      IBM Cloud Private knowledge sharing
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        IBM Cloud Private knowledge sharing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../icp/" title="Main summary" class="md-nav__link">
      Main summary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../icp/icp-cli/" title="CLI summary" class="md-nav__link">
      CLI summary
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../icp/icp-integration/" title="Integration on ICP" class="md-nav__link">
      Integration on ICP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../icp/build-helm-rep/" title="Build your own helm repository" class="md-nav__link">
      Build your own helm repository
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../icp/dev-env-install/" title="Install a dev cluster" class="md-nav__link">
      Install a dev cluster
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../icp/faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../icp/troubleshooting/" title="Troubleshouting" class="md-nav__link">
      Troubleshouting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../service-mesh/readme/" title="Service mesh" class="md-nav__link">
      Service mesh
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../istio/readme/" title="Istio introduction" class="md-nav__link">
      Istio introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../csmo/" title="CSMO" class="md-nav__link">
      CSMO
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12" checked>
    
    <label class="md-nav__link" for="nav-12">
      Security
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Security
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        TLS
      </label>
    
    <a href="./" title="TLS" class="md-nav__link md-nav__link--active">
      TLS
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-tls-summary" title="Quick TLS summary" class="md-nav__link">
    Quick TLS summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" title="pre-requisites" class="md-nav__link">
    pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-get-ibm-cloud-secure-gateway-certificate" title="1. Get IBM Cloud Secure Gateway certificate" class="md-nav__link">
    1. Get IBM Cloud Secure Gateway certificate
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-get-the-apic-server-certificate" title="2. Get the APIC server certificate" class="md-nav__link">
    2. Get the APIC server certificate
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-using-self-certified-tsl-certificates-in-a-client-app" title="3. Using Self certified TSL certificates in a client app" class="md-nav__link">
    3. Using Self certified TSL certificates in a client app
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nodejs-app" title="Nodejs app" class="md-nav__link">
    Nodejs app
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-download-the-api-connect-certificate" title="Step 5- Download the API Connect certificate" class="md-nav__link">
    Step 5- Download the API Connect certificate
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../journey/" title="Skill Journey" class="md-nav__link">
      Skill Journey
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-tls-summary" title="Quick TLS summary" class="md-nav__link">
    Quick TLS summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" title="pre-requisites" class="md-nav__link">
    pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-get-ibm-cloud-secure-gateway-certificate" title="1. Get IBM Cloud Secure Gateway certificate" class="md-nav__link">
    1. Get IBM Cloud Secure Gateway certificate
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-get-the-apic-server-certificate" title="2. Get the APIC server certificate" class="md-nav__link">
    2. Get the APIC server certificate
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-using-self-certified-tsl-certificates-in-a-client-app" title="3. Using Self certified TSL certificates in a client app" class="md-nav__link">
    3. Using Self certified TSL certificates in a client app
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nodejs-app" title="Nodejs app" class="md-nav__link">
    Nodejs app
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-download-the-api-connect-certificate" title="Step 5- Download the API Connect certificate" class="md-nav__link">
    Step 5- Download the API Connect certificate
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ibm-cloud-architecture/refarch-integration/edit/master/docs/TLS.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="configure-tls-end-to-end-between-ibm-cloud-app-and-back-end-service">Configure TLS end to end between IBM CLoud app and back end service</h1>
<p>The connection between bluemix app to back end data access service needs to be over HTTPS, HTTP over SSL. To make SSL working end to end we need to do certificate management, configure trust stores, understand handshaking, and other details that must be perfectly aligned to make the secure communication work.</p>
<h2 id="quick-tls-summary">Quick TLS summary</h2>
<p>TLS and SSL uses public key/private key cryptography to encrypt data communication between the server and client, to allow the server to prove its identity to the client, and the client to prove its identity to the server.</p>
<p>Three fundamental components are involved in setting up an SSL connection between a server and client:</p>
<ul>
<li>a certificate,</li>
<li>a public key,</li>
<li>a private key.   </li>
</ul>
<p>Certificates are used to identify an identity: (CN, owner, location, state,... using the X509 distinguished name).</p>
<p>Entity can be a person or a computer. As part of the identity, the CN or Common Name attribute is the name used to identify the domain name of the server host.</p>
<p>To establish a secure connection to API Connect server, a client first resolves the domain name as specified in CN. After the SSL connection has been initiated, one of the first things the server will do is to send its digital certificate. The client will perform a number of validation steps before determining if it will continue with the connection. Most importantly, the client will compare the domain name of the server it intended to connect to (in this case, 172.16.50.8) with the common name (the “CN” field) found in the subject’s identity on the certificate. If these names do not match, it means the client does not trust the identity of the server. This is the hand shake step.</p>
<p>Public keys and private keys are number pairs with a special relationship. Any data encrypted with one key can be decrypted with the other. This is known as asymmetric encryption. The server’s public key is embedded within its certificate. The public key is freely distributed so anyone wishing to establish an encrypted channel with the server may encrypt their data using the server’s public key. Data encrypted with a private key may be decrypted with the corresponding public key. This property of keys is used to ensure the integrity of a digital certificate in a process called digital signing.</p>
<p>In term of server / certificate we need to prepare a set of things, the following schema may help to understand the dependencies:</p>
<p><img alt="" src="../ssl-cert-e2e.png" /></p>
<p>API Gateway has its own public certificate, as IBM Secure Gateway.</p>
<ul>
<li>Get SSL Certificate for the API Connect Gateway end point from a Certificate Agency giving your domain name, with assured identity. The IBM self certified certificate should not work when the service consumer will do a hostname validation. For <em>Brown Compute</em> we are still using the self certified certificate and we will highlight the impact on the client code to bypass host validation.</li>
<li>Define TLS profile configuration for API Connect using its Cloud Management console</li>
<li>Get certificate for each of the components in the path</li>
</ul>
<p>Let go over those steps in details:</p>
<h2 id="pre-requisites">pre-requisites</h2>
<p>You need to have <a href="https://www.openssl.org/">openssl</a> installed on your computer. For MAC users it is already installed. If you need to install see instruction <a href="https://www.openssl.org/source/">here</a></p>
<h2 id="1-get-ibm-cloud-secure-gateway-certificate">1. Get IBM Cloud Secure Gateway certificate</h2>
<p>The following command returns a lot of helpful information from a server like the IBM Secure Gateway we <a href="https://github.com/ibm-cloud-architecture/refarch-integration-utilities/blob/master/docs/ConfigureSecureGateway.md">configured</a> on Bluemix.
<div class="codehilite"><pre><span></span>openssl s_client -connect cap-sg-prd-5.integration.ibmcloud.com:16582`
</pre></div></p>
<ul>
<li>Adapt the URL with your own Secure Gateway service end point*</li>
</ul>
<p>In the returned output, we can see the certificate chain presented by the server with the subject and issuer information:
<div class="codehilite"><pre><span></span>Certificate chain
 0 s:/C=US/ST=NC/L=Durham/O=IBM Corporation/OU=SWG/CN=*.integration.ibmcloud.com
   i:/C=US/O=DigiCert Inc/CN=DigiCert SHA2 Secure Server CA
 1 s:/C=US/O=DigiCert Inc/CN=DigiCert SHA2 Secure Server CA
   i:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert Global Root CA
</pre></div>
one important output is the protocol and cipher suite used:
<div class="codehilite"><pre><span></span>SSL-Session:
    Protocol  : TLSv1
    Cipher    : AES256-SHA
</pre></div>
If we need to keep the server's PEM-encoded certificate save the string ""---BEGIN CERTIFICATE  to END CERTIFICATE" to a file. (e.g sg.pem). The following command will do it for you:
<code>echo | openssl s_client -connect cap-sg-prd-5.integration.ibmcloud.com:16582 -showcerts 2&gt;&amp;1 | sed  -n '/BEGIN CERTIFICATE/,/-END CERTIFICATE-/p'&gt; sg.pem</code></p>
<p>By default, s_client will print only the leaf certificate; as we want to print the entire chain, we use -showcerts switch.</p>
<p>Use this certificate for the client code in Bluemix.</p>
<p>As an alternate we can download the authentication files from the Secure Gateway destination:<br />
<img alt="" src="../sg-dest-detail.png" /><br />
as explained in <a href="https://github.com/ibm-cloud-architecture/refarch-integration-utilities/blob/master/docs/ConfigureSecureGateway.md#step-3--define-destination-for-secure-gateway-service">this article</a> and use all those certificates files to define the connection.</p>
<h2 id="2-get-the-apic-server-certificate">2. Get the APIC server certificate</h2>
<p>When connected via VPN to your on-premise environment, you can get the TLS certificate for the API Connect Gateway server via the command:
<code>echo | openssl s_client -connect 172.16.50.8:443 -showcerts 2&gt;&amp;1 | sed  -n '/BEGIN CERTIFICATE/,/-END CERTIFICATE-/p'&gt; apicgw.pem</code></p>
<h2 id="3-using-self-certified-tsl-certificates-in-a-client-app">3. Using Self certified TSL certificates in a client app</h2>
<p>To make TSL working end to end we need to do certificate management, configure trust stores, understand handshaking, and other details that must be perfectly aligned to make the secure communication work.</p>
<p>We assume we downloaded the different certificates from secure gateway, the connection between the client app and the secure gateway is via TLS mutual auth.</p>
<h3 id="nodejs-app">Nodejs app</h3>
<p>Using the <code>request</code> module we can use the different certificates as settings to the <code>options</code> argument of the connection. Here is an example of a HTTP GET over TLS:</p>
<p><div class="codehilite"><pre><span></span><span class="nx">request</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span>
    <span class="p">{</span><span class="nx">url</span><span class="o">:</span><span class="s1">&#39;https://cap-sg-prd-5.integration.ibmcloud.com:16582/csplab/sb/sample-inventory-api/items&#39;</span><span class="p">,</span>
    <span class="nx">timeout</span><span class="o">:</span> <span class="mi">10000</span><span class="p">,</span>
    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
      <span class="s1">&#39;x-ibm-client-id&#39;</span><span class="o">:</span> <span class="s1">&#39;1dc939dd-xxxx&#39;</span><span class="p">,</span>
      <span class="s1">&#39;accept&#39;</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
      <span class="s1">&#39;content-type&#39;</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span>
      <span class="p">}</span>
    <span class="p">});</span>
</pre></div>
So we need to prepare those input files on the client side (in the Case inc portal code source for example):
<em> Create a key store with the openssl tool.
<div class="codehilite"><pre><span></span>openssl pkcs12 -export -in &quot;./ssl/qsn47KM8iTa_O495D_destCert.pem&quot; -inkey &quot;./ssl/qsn47KM8iTa_O495D_destKey.pem&quot; -out &quot;ssl/sg_key.p12&quot; -name &quot;CaseIncCliCert&quot; -noiter -password pass:&quot;asuperpwd&quot;
</pre></div>
 The file is sg_key.p12
</em> Create a trust store from the DigiCertCA2.pem file
<div class="codehilite"><pre><span></span><span class="n">keytool</span> <span class="o">-</span><span class="kn">import</span> <span class="o">-</span><span class="n">alias</span> <span class="n">PrimaryCA</span> <span class="o">-</span><span class="nb">file</span> <span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">DigiCertCA2</span><span class="o">.</span><span class="n">pem</span> <span class="o">-</span><span class="n">storepass</span> <span class="n">password</span> <span class="o">-</span><span class="n">keystore</span> <span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">sg_trust</span><span class="o">.</span><span class="n">jks</span>
</pre></div>
<em> Then for the secondary CA
<div class="codehilite"><pre><span></span><span class="n">keytool</span> <span class="o">-</span><span class="kn">import</span> <span class="o">-</span><span class="n">alias</span> <span class="n">SecondaryCA</span> <span class="o">-</span><span class="nb">file</span> <span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">DigiCertTrustedRoot</span><span class="o">.</span><span class="n">pem</span> <span class="o">-</span><span class="n">storepass</span> <span class="n">password</span> <span class="o">-</span><span class="n">keystore</span> <span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">sg_trust</span><span class="o">.</span><span class="n">jks</span>
</pre></div>
</em> finally the certificate for the secure gateway
<div class="codehilite"><pre><span></span><span class="n">keytool</span> <span class="o">-</span><span class="kn">import</span> <span class="o">-</span><span class="n">alias</span> <span class="n">BmxGtwServ</span> <span class="o">-</span><span class="nb">file</span> <span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">secureGatewayCert</span><span class="o">.</span><span class="n">pem</span> <span class="o">-</span><span class="n">storepass</span> <span class="n">password</span> <span class="o">-</span><span class="n">keystore</span> <span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">sg_trust</span><span class="o">.</span><span class="n">jks</span>
</pre></div></p>
<h3 id="step-5-download-the-api-connect-certificate">Step 5- Download the API Connect certificate</h3>
<p>To access the certificate use a Web browser, like Firefox, to the target URL using HTTPS. Access the Security &gt; Certificate from the locker icon on left side of the URL field. (Each web browser has their own way to access to the self certified certificates)</p>
<p>Use the export button to create a new local file with suffix .crt. From there you need to persist the file on the operating system trust store.</p>
<p>```</p>
<h1 id="get-certificate-in-the-form-of-a-crt-file-then-mv-it-to-ca-certificate">get certificate in the form of a .crt file, then mv it to ca-certificate</h1>
<p>$ sudo mv APIConnect.crt /usr/local/share/ca-certificate</p>
<h1 id="to-add-en-try-to-the-certificates-use-the-command">To add en try to the certificates use the command</h1>
<p>$ sudo update-ca-certificates</p>
<h1 id="verify-with">verify with</h1>
<p>$ ls -al /etc/ssl/certs | grep APIConnect
$ openssl s_client -showcerts -connect 172.16.50.8:443
<div class="codehilite"><pre><span></span>## Specific to Java Trust store

Java Runtime Environment comes with a pre-configure set of trusted certificate authorities. The collection of trusted certificates can be found at $JAVA_HOME/jre/lib/security/cacerts The tests are run on the utility server, so the API Connect server CA certificate needs to be in place. To do so the following needs to be done:

Remote connect to the API Connect Gateway Server with a Web Browser and download the certificate as .crt file
</pre></div>
$ sudo keytool -import -trustcacerts -alias brownapic -file APIConnect.crt -keystore $JAVA_HOME/jre/lib/security/cacerts -storepass changeit
$ keytool -list -keystore $JAVA_HOME/jre/lib/security/cacerts
```</p>
<p>Attention these steps will make the Java program using HTTP client working only if the certificate is defined by a certified agency. The self generated certificate has a CN attribute sets to a non-hostname, and HTTP client in Java when doing SSL connection are doing a hostname verification. See the test project for the detail on how it was bypassed, in Brown compute.</p>
<h2 id="references">References</h2>
<ul>
<li>Open SSL <a href="http://www.openssl.org">web site</a></li>
<li><a href="https://www.feistyduck.com/library/openssl-cookbook/online/ch-testing-with-openssl.html">SSL Cookbook</a></li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../csmo/" title="CSMO" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                CSMO
              </span>
            </div>
          </a>
        
        
          <a href="../journey/" title="Skill Journey" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Skill Journey
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>